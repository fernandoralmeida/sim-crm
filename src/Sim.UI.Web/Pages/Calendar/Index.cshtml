@page "/calendar/{y?}/{m?}"
@model CalendarPage

@{
    ViewData["Title"] = "Bem Vindos";
    ViewData["ActivePage"] = Web.Pages.Shared.LayoutNavPages.Agenda;
    ViewData["ActivePageLi"] = Web.Pages.Shared.LayoutNavPages.Calendar;
}

<!-- Dropdown Structure Year -->
<ul id="dropdownYear" class="dropdown-content">
    @foreach (var item in Model.DoCalendar.Years!)
    {
        <li class="submit"><a asp-page="./Index" asp-route-y="@item" asp-route-m="@Model.CtrlCalendar.Month">@item</a></li>
    }
</ul>

<!-- Dropdown Structure Month -->
<ul id="dropdownMonth" class="dropdown-content">
    @foreach (var item in Model.DoCalendar.Months!)
    {
        <li class="submit"><a asp-page="./Index" asp-route-y="@Model.CtrlCalendar.Ano"
                asp-route-m="@item.Value">@item.Key</a>
        </li>
    }
</ul>

<nav class="navbar transparent">
    <div class="nav-wrapper">
        <ul class="right">
            <li class="submit">
                <a asp-page="/Agenda/Eventos/Index" class="btn-link right "><i class="material-icons "
                        title="Adicionar Evento">calendar_add_on</i></a>
            </li>
            <li class="submit">
                <a asp-page="./Index" asp-route-y="@Model.CtrlCalendar.Ano"
                    asp-route-m="@Model.CtrlCalendar.Previous"><i class="material-icons">arrow_back_ios</i></a>
            </li>
            <li>
                <a class="dropdown-trigger" href="#!" data-target="dropdownYear">@Model.CtrlCalendar.Ano<i
                        class="material-icons right">keyboard_arrow_down</i></a>
            </li>
            <li>
                <a class="dropdown-trigger" href="#!" data-target="dropdownMonth">@Model.DoCalendar.Month?.ToUpper()<i
                        class="material-icons right">keyboard_arrow_down</i></a>
            </li>
            <li class="submit">
                <a asp-page="./Index" asp-route-y="@Model.CtrlCalendar.Ano" asp-route-m="@Model.CtrlCalendar.Next"><i
                        class="material-icons">arrow_forward_ios</i></a>
            </li>
        </ul>
    </div>
</nav>

<div class="calendar">
    @foreach (var item in Model.DoCalendar.Head!)
    {
        <div class="calendar cell head">@item</div>
    }
    @foreach (var item in Model.DoCalendar.Days!)
    {
        <div class="calendar cell content">
            <div class="content head">
                @item.Title

                @if (item.Title != "...")
                {
                    <a class="btn-link right text-color-purple modal-trigger save-btn" data-d="@item.Title"
                        data-m="@Model.CtrlCalendar.Month" data-a="@Model.CtrlCalendar.Ano" href="#modalLembretes"><i
                            class="material-icons" title="Adicionar Lembrete">bookmark_add</i></a>
                }
            </div>
            <div>
                @if (item.Events!.Any())
                {
                    @foreach (var subitem in item.Events!)
                    {
                        var _t = subitem.IsRemind == true ? "content items reminders" : "content items ";
                        var _d = subitem.Data < DateTime.Now ? " old" : "";

                        <a class="@_t @_d" asp-page="/Agenda/Inscricoes/Index" asp-route-id="@subitem.Code">@subitem.Name</a>
                    }
                }
                else
                {
                    <span class="no-events" aria-label="Nenhum evento">Nenhum evento</span>
                }
            </div>
        </div>
    }
</div>

@* <div class="calendar" role="table" aria-label="Calendário"> *@
<!-- Cabeçalho do Calendário -->
@* <div class="calendar-header">
@foreach (var item in Model.DoCalendar.Head!)
{
<div class="calendar-cell head" role="columnheader" aria-label="@item">@item</div>
}
</div> *@

<!-- Dias do Calendário -->
@* <div class="calendar-body">
@foreach (var item in Model.DoCalendar.Days!)
{
<div class="calendar-cell content" role="cell" aria-label="Dia @item.Title">
<div class="day-header">
@item.Title
@if (item.Title != "...")
{
<a class="btn-link right text-color-purple modal-trigger" href="#modalLembretes"
aria-label="Adicionar Lembrete">
<i class="material-icons" title="Adicionar Lembrete">bookmark_add</i>
</a>
}
</div>

<div class="events-container">
@if (item.Events!.Any())
{
@foreach (var subitem in item.Events!)
{
var eventClass = subitem.IsRemind ? "content-item reminders" : "content-item";
var dateClass = subitem.Data < DateTime.Now ? " old" : "";

<a class="@eventClass @dateClass" asp-page="/Agenda/Inscricoes/Index" asp-route-id="@subitem.Code"
aria-label="Evento @subitem.Name">@subitem.Name</a>
}
}
else
{
<span class="no-events" aria-label="Nenhum evento">Nenhum evento</span>
}
</div>
</div>
}
</div>
</div> *@

<!-- Modal Structure Lembretes -->
<div id="modalLembretes" class="modal">
    <div class="modal-content">
        <h6>Lembrete</h6>
        <div class="divider"></div>
        <form class="row mgn-0" method="post">
            <div class="input-field col s12" hidden>
                <input type="text" asp-for="InputModel.Id">
                <label asp-for="InputModel.Id"></label>
            </div>
            <div class="input-field col s6">
                <input type="text" asp-for="InputModel.Titulo">
                <label asp-for="InputModel.Titulo"></label>
            </div>
            <div class="input-field col s6">
                <input type="text" asp-for="InputModel.Local">
                <label asp-for="InputModel.Local"></label>
            </div>
            <div class="input-field col s4">
                <select asp-for="InputModel.Visivel" asp-items="Model.Acessos"
                    title="Acesso: quem pode ver o meu lembrete!">
                </select>
                <label asp-for="InputModel.Visivel"></label>
            </div>
            <div class="input-field col s4">
                <input type="date" asp-for="InputDate">
                <label asp-for="InputDate"></label>
            </div>
            <div class="input-field col s4">
                <input type="time" asp-for="InputTime">
                <label asp-for="InputTime"></label>
            </div>
            <div class="input-field col s12">
                <input type="text" asp-for="InputModel.Descricao">
                <label asp-for="InputModel.Descricao"></label>
            </div>
            <div class="input-field col s12">
                <button class="waves-effect waves-light btn">Gravar<i class="material-icons left">save</i></button>
            </div>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Seleciona todos os links com a classe 'save-btn'
        const saveButtons = document.querySelectorAll('.save-btn');

        // Adiciona um listener de clique em cada botão
        saveButtons.forEach(button => {
            button.addEventListener('click', function (event) {
                // Evita o comportamento padrão do link, se necessário
                event.preventDefault();

                // Obtém os valores dos atributos data
                const day = this.getAttribute('data-d');
                const month = this.getAttribute('data-m');
                const year = this.getAttribute('data-a');

                // Concatena os valores em um formato de data, por exemplo: dd/mm/yyyy
                const concatenatedDate = `${day}/${month}/${year}`;

                // Coloca o valor concatenado no campo de input
                document.getElementById('InputDate').value = concatenatedDate;
            });
        });
    });
</script>